{% extends "base.html" %}

{% block title %} Résultat {% endblock %}

{% block bodyId %}result{% endblock %}

{% block content %}
	{{ res }}
{% endblock %}

{% block javascript %}
<script type="text/javascript">
	var width = $(document).width(),
	    height = $(document).height();

	var svg = d3.select("body").append("svg")
	    .attr("width", width)
	    .attr("height", height);

	var centroids_coord = [[],[],[]];
	var centroids_limit = [];
	var rand = [];
	var coef = 100;
	var colors = ["steelblue", "salmon", "limegreen", "chocolate", "chartreuse", "seagreen"];

	d3.json("test3.json", function(error, json){
	  if (error) return console.error(error);

	  for (var i = 0; i < json.observations.length%1000; i++) {
	    rand[i] = randomNumberFromRange(-Math.PI,Math.PI)
	  };

	  // centroids
	  svg.selectAll(".centroid").data(json.centroids).enter()
	  .append("circle")
	  .attr("cx", function(d, i) {
	    var x = width/(json.centroids.length+1)*(i+1);
	    centroids_coord[i][0] = x;
	    centroids_limit[i] = 0;
	    return x;
	  })
	  .attr("cy", function(d, i) {
	    var y = height/2;
	    centroids_coord[i][1] = y;
	    return y;
	  })
	  .attr("r", function(d) {return 2})
	  .attr("class", "centroid");


	  //observations
	  svg.selectAll(".observation").data(json.observations).enter()
	  .append("circle")
	  .attr("cx", function(d, i) {
	    if(centroids_limit[d.cluster] < d.value)
	      centroids_limit[d.cluster] = d.value;
	    return centroids_coord[d.cluster][0] + d.value*coef * Math.cos(rand[i%1000]);
	  })
	  .attr("cy", function(d, i) {
	    return centroids_coord[d.cluster][1] + d.value*coef * Math.sin(rand[i%1000]);
	  })
	  .attr("r", function(d) {return 3;})
	  .style("fill", function(d) {return colors[d.cluster%colors.length];})
	  .attr("class", "observation");

	  // boundary
	  svg.selectAll(".boundary").data(centroids_limit, function(d) {return d;}).enter()
	  .append("circle")
	  .attr("cx", function(d, i) {
	    return centroids_coord[i][0];
	  })
	  .attr("cy", function(d, i){
	    return centroids_coord[i][1];
	  })
	  .attr("r", function(d, i){
	    return d*coef;
	  })
	  .style("stroke", "grey")
	  .style("fill", "none")
	  .attr("class", "limit");


	  // threshold
	  var n = json.N;

	  if(n>0){
	    svg.selectAll(".threshold").data(centroids_limit, function(d) {return d;}).enter()
	    .append("circle")
	    .attr("cx", function(d, i) {
	      return centroids_coord[i][0];
	    })
	    .attr("cy", function(d, i){
	      return centroids_coord[i][1];
	    })
	    .attr("r", function(d, i){
	      return ((d*coef)*(100-n))/100;
	    })
	    .style("stroke", "crimson")
	    .style("fill", "none");
	  }
	});

	function randomNumberFromRange(min,max)
	{
	    var randomNumber = Math.random()*(max-min+1)+min;
	    return randomNumber;
	}

</script>
{% endblock %}